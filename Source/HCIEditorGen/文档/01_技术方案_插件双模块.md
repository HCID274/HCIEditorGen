# HCIAbilityKit 技术方案（插件双模块 + 智能中介者）

> 状态：冻结（M0-V2）
> 版本：v2
> 更新时间：2026-02-12

## 1. 重构目标

- 当前原型已具备 Import/Reimport 基础能力，但存在耦合高、复用差、复杂需求生产力不足的问题。
- 本次重构目标：建立 `数据 -> AI -> 资产` 的稳定管线，并将能力抽离为可复用插件。
- 核心价值：解决策划填表难、资产检索难、数据校验累。

## 2. 架构选择（冻结）

```text
Plugins/HCIAbilityKit/
  HCIAbilityKit.uplugin
  Source/
    HCIAbilityKitRuntime/
    HCIAbilityKitEditor/
```

- `HCIAbilityKitRuntime`：数据模型、解析校验、可测试服务层。
- `HCIAbilityKitEditor`：Factory/Reimport、菜单命令、交互工具。
- 依赖必须单向：`Editor -> Runtime`。

## 3. 核心交互逻辑：智能中介者

### A. 智能调度层（语义路由）

- 采用轻量方案 B：`Skill(.md)` + `Python Script(.py)`。
- AI 根据用户意图匹配技能，再调用对应脚本执行。
- 涉及修改、删除、批量写入时必须执行授权门禁（说明原因 + 等待确认）。

### B. 执行与审计层（串行双角色）

- 采用方案 A：生成者与审计者串行复核。
- 生成者负责提取与变更建议。
- 审计者独立检查逻辑可疑点（数值异常、字段冲突、遗漏约束）。
- 输出必须包含“可疑项清单”与“最终可执行建议”。

### C. 审阅交互层（步骤化对比）

- 采用方案 B：计划清单 + Diff 风格逐项对比。
- 用户可按字段局部采纳，不允许黑盒整包覆盖。
- 目标是可解释、可回滚、可追踪。

## 4. 职责分配（最小集合）

- `UHCIAbilityKitAsset`（Runtime）：承载派生资产字段与源信息。
- `FHCIAbilityKitParserService`（Runtime）：解析、校验、标准化输出。
- `UHCIAbilityKitFactory`（Editor）：导入/重导入编排、资产写入、错误反馈。
- `FHCIAbilityKitEditorModule`（Editor）：菜单/命令注册与工具入口。
- `HCIAbilityKit` Python 层：技能脚本执行与审计桥接（Step2 开始接入）。

## 5. 技术演进路线（Roadmap）

1. **Step 1 结构迁移**：迁移至插件双模块，保持现有行为不变。
2. **Step 2 服务抽离**：解析从 Factory 抽到 Runtime 服务层，引入 Python 脚本驱动。
3. **Step 3 AI 注入**：接入 LLM，实现基于 Skill 文档的语义调度与提取。
4. **Step 4 UI 升级**：实现交互式审阅 UI（计划流 + 字段 Diff + 局部采纳）。

## 6. 质量约束

- 失败不脏写：校验失败不得污染已有资产。
- 错误可定位：至少包含文件、字段、原因、建议。
- 功能增量顺序：先稳定 Import/Reimport，再引入 AI，不跳阶段。

## 7. 验收口径

- Step 1 完成时：插件形态下 Import/Reimport 与当前行为一致。
- Step 2 完成时：Factory 只做编排，解析校验可独立测试。
- Step 3 完成时：语义路由能正确匹配技能并给出可审计计划。
- Step 4 完成时：用户可视化审阅并逐项采纳建议。

## 8. 已冻结技术选型（2026-02-12）

- Python 运行环境：`UE 内置 Python`。
- 模型接入方式：在线 `API`（不做本地推理集成）。
- 授权门禁交互：`Custom Slate Panel` 可审计审批面板。
