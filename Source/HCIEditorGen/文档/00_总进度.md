# HCIAbilityKit 总进度（重构 V2）

> 项目根目录：`D:\1_Projects\04_GameDev\UE_Projects\HCIEditorGen`
> 引擎版本：`UE 5.4.4`
> 更新时间：`2026-02-12`
> 当前阶段：`Step2-Slice3（待实现）`
> 当前策略：`先文档冻结 -> 再切片开发 -> 每切片停测`

## 1. 范围冻结（唯一主线）

- 仅做 `HCIAbilityKit`，不扩展到无关系统。
- 固定架构：`HCIAbilityKitRuntime + HCIAbilityKitEditor`（插件双模块）。
- 固定目标：建立 `数据 -> AI -> 资产` 管线，解决填表、检索、校验三类痛点。
- 固定流程：`计划 -> 执行 -> 审阅`，敏感操作必须授权门禁。

## 2. 已完成事实（不回滚）

- 环境准备与工程可编译状态已确认通过。
- Import/Reimport 基础闭环已在 UE 中验证通过（含源路径可见）。
- 插件双模块方向已达成决策共识（本次方案进一步升级为 V2）。
- 插件骨架已落地：`HCIAbilityKitRuntime + HCIAbilityKitEditor`，命令行编译通过，等待 UE 手测门禁确认。
- Step1-Slice1 UE 手测已通过（Reimport 正常）。
- Step1-Slice2 代码迁移完成：资产类/Factory/菜单迁移至插件双模块，编译通过并已完成 UE 手测通过。
- Step1-Slice3 代码收口完成：本体 `HCIEditorGenEditor` 模块已下线，编辑器能力统一由 `Plugins/HCIAbilityKit` 提供。
- Step1-Slice4 交互补强完成：Reimport 失败时会显示 Editor 通知，失败原因可直接可视化。
- Step2-Slice1 服务抽离完成：Factory 解析逻辑已迁移到 Runtime 解析服务并通过 UE 手测。
- Step2-Slice2 Python 入口完成：新增 Runtime Python Hook 与 Editor 侧 UE 内置 Python 执行链路。

## 3. Roadmap（四步）

## Step 1 结构迁移（已完成）

- 目标：在不改变现有行为的前提下，迁移到插件双模块骨架。
- 完成标准：
  - Import/Reimport 行为与当前一致；
  - Runtime/Editor 依赖方向正确；
  - UE 手测通过后才进入 Step 2。

## Step 2 服务抽离（进行中）

- 目标：解析/校验从 Factory 抽离到 Runtime 服务层，引入 Python 脚本驱动。
- 完成标准：
  - Factory 仅编排，不包含核心解析逻辑；
  - 解析与校验可独立验证；
  - UE 手测通过。

## Step 3 AI 注入（待开始）

- 目标：接入 LLM，支持 Skill 文档驱动的语义路由。
- 完成标准：
  - 能正确命中 Skill；
  - 敏感操作有授权门禁；
  - 生成结果具备审计记录。

## Step 4 UI 升级（待开始）

- 目标：实现交互式审阅界面（计划清单 + 字段 Diff + 局部采纳）。
- 完成标准：
  - 用户可逐项采纳建议；
  - 可见旧值/新值；
  - 支持回滚与重试。

## 4. 测试门禁（强制）

- 每个切片必须执行：编译 -> UE 手测 -> 记录。
- 用户未明确 `Pass`，不得进入下一切片。
- 记录目录：`Source/HCIEditorGen/文档/测试记录/`
- 测试源数据：`SourceData/AbilityKits/`

## 5. 当前切片（下一步）

- 切片编号：`Step2-Slice3`
- 当前状态：`待开发`
- 切片目标：让 Python Hook 产生结构化输出并接入字段映射（先从 `DisplayName` 单字段开始）。
- 验收动作（UE）：
  - 打开工程并编译 Editor；
  - 在源文件中添加 Python 可读字段（例如 `display_name_ai`）；
  - Reimport 后确认 `DisplayName` 由 Python 输出驱动；
  - 关闭 Python 输出后确认回退到原解析值，且无脏写。
- 通过后动作：进入 Step2-Slice4（统一错误契约并沉淀 Python 审计输出格式）。

## 6. 文档索引（冻结）

- 技术方案：`Source/HCIEditorGen/文档/01_技术方案_插件双模块.md`
- 测试门禁：`Source/HCIEditorGen/文档/02_测试门禁与节奏.md`
- 契约规范：`Source/HCIEditorGen/文档/03_Schema_v1与错误契约.md`

## 7. 进度日志

- `2026-02-08`：完成环境准备并建立基础文档体系。
- `2026-02-09`：完成 `UHCIAbilityKitAsset` 与 Import/Reimport 闭环验证。
- `2026-02-11`：确认采用插件双模块方向（Runtime + Editor）。
- `2026-02-12`：按新方案重置为 V2 路线，冻结“智能中介者 + 四步演进 + 强制停测”。
- `2026-02-12`：完成 Step1-Slice1 代码侧骨架（新增 `Plugins/HCIAbilityKit` 双模块并启用插件）；`Build.bat HCIEditorGenEditor Win64 Development` 编译通过，待 UE 手测后决定是否进入 `Step1-Slice2`。
- `2026-02-12`：用户确认 Step1-Slice1 UE 手测通过（Reimport 正常）。
- `2026-02-12`：完成 Step1-Slice2 代码迁移：`UHCIAbilityKitAsset` 迁入 `HCIAbilityKitRuntime`，`UHCIAbilityKitFactory` 与 Reimport 菜单迁入 `HCIAbilityKitEditor`，旧模块同名实现已移除，新增 `ActiveClassRedirects`；命令行编译通过，待 UE 手测。
- `2026-02-12`：用户确认 Step1-Slice2 UE 手测通过；失败原因为测试 JSON 非法，修正后 Reimport 正常，类重定向验证通过。
- `2026-02-12`：完成 Step1-Slice3 代码收口：`HCIEditorGen.uproject` 移除本体 `HCIEditorGenEditor` 模块声明，`HCIEditorGenEditor.Target.cs` 仅保留 `HCIEditorGen`，并删除 `Source/HCIEditorGenEditor` 空壳模块文件；规则检查通过，命令行编译受 Live Coding 占用阻断，待 UE 手测门禁确认。
- `2026-02-12`：用户确认 Step1-Slice3 UE 手测通过。
- `2026-02-12`：完成 Step1-Slice4 交互补强：`UHCIAbilityKitFactory::Reimport` 在失败分支新增 Editor Notification（显示资产名与失败原因）；命令行编译通过，待 UE 手测门禁确认。
- `2026-02-12`：用户确认 Step1-Slice4 UE 手测通过（通知可见，JSON 格式错误原因可见）；Step1 结构迁移阶段关闭。
- `2026-02-12`：完成 Step2-Slice1 代码抽离：新增 `HCIAbilityKitRuntime` 解析服务 `FHCIAbilityKitParserService` 与 `FHCIAbilityKitParsedData`，并将 `UHCIAbilityKitFactory` 的 JSON 解析迁移为调用 Runtime 服务；命令行编译通过，待 UE 手测门禁确认。
- `2026-02-12`：用户确认 Step2-Slice1 UE 手测通过；Runtime 解析服务抽离完成且行为与原链路一致。
- `2026-02-12`：完成 Step2-Slice2 Python 入口：`FHCIAbilityKitParserService` 新增可注入 Python Hook；`FHCIAbilityKitEditorModule` 启动时注册 UE 内置 Python 执行回调并在关闭时清理；新增脚本 `SourceData/AbilityKits/Python/hci_abilitykit_hook.py`，支持 `__force_python_fail__` 受控失败；命令行编译通过，待 UE 手测门禁确认。
- `2026-02-12`：用户确认 Step2-Slice2 UE 手测通过；已验证 Python Hook 调用成功、受控失败可见且可恢复。
