# HCIAbilityKit 代码框架总览（树内中文注释版）

> 只保留手写源码与配置目录；`Binaries/`、`Intermediate/`、`Saved/`、`DerivedDataCache/` 为生成目录，故省略。

```text
HCIEditorGen/                                                # 项目根目录
|-- HCIEditorGen.uproject                                    # UE 项目描述，模块与插件装配入口
|-- AGENTS.md                                                # 协作规则与开发约定
|-- Config/                                                  # 项目配置
|   |-- DefaultEngine.ini                                    # 引擎级配置
|   |-- DefaultEditor.ini                                    # 编辑器行为配置
|   |-- DefaultGame.ini                                      # 游戏逻辑配置
|   `-- DefaultInput.ini                                     # 输入映射配置
|-- Plugins/                                                 # 可复用功能插件目录
|   `-- HCIAbilityKit/                                       # AbilityKit 主插件
|       |-- HCIAbilityKit.uplugin                            # 插件入口；声明 Runtime/Editor 模块 + PythonScriptPlugin
|       `-- Source/                                          # 插件源码
|           |-- HCIAbilityKitRuntime/                        # 运行时模块（只放可运行时代码）
|           |   |-- HCIAbilityKitRuntime.Build.cs            # Runtime 依赖声明（Core/Engine/Json/AssetRegistry）
|           |   |-- Public/
|           |   |   |-- HCIAbilityKitRuntimeModule.h         # Runtime 模块类声明
|           |   |   |-- HCIAbilityKitAsset.h                 # 资产数据结构（SchemaVersion/Id/DisplayName/Damage）
|           |   |   |-- Agent/
|           |   |   |   `-- HCIAbilityKitToolRegistry.h      # StageE-E1 Tool Registry 能力声明（白名单 + args_schema + 元信息）
|           |   |   |-- Audit/
|           |   |   |   |-- HCIAbilityKitAuditTagNames.h     # 审计链路统一资产标签键（hci_id/hci_representing_mesh 等）
|           |   |   |   |-- HCIAbilityKitAuditRule.h         # StageC-C1 审计规则契约（Severity/Issue/Context/IHCIAbilityAuditRule）
|           |   |   |   |-- HCIAbilityKitAuditReport.h       # StageC-C3 统一审计结果结构（AuditReport/AuditResultEntry + Severity 字符串化）
|           |   |   |   |-- HCIAbilityKitAuditReportJsonSerializer.h # StageC-C4 审计报告 JSON 序列化器接口
|           |   |   |   |-- HCIAbilityKitAuditRuleRegistry.h # StageC-C1 规则注册中心（注册/启停/执行）
|           |   |   |   |-- HCIAbilityKitAuditScanService.h  # StageB-B2 元数据扫描服务接口（AssetRegistry/FAssetData）
|           |   |   |   `-- HCIAbilityKitPreviewActor.h      # StageB-B7 数据驱动预览体（读取 RepresentingMesh -> StaticMeshComponent）
|           |   |   |-- Services/
|           |   |       `-- HCIAbilityKitParserService.h     # 解析服务接口 + Python Hook 抽象
|           |   |   `-- Search/
|           |   |       |-- HCIAbilityKitSearchSchema.h      # 检索语义文档与索引结构定义（Slice1）
|           |   |       |-- HCIAbilityKitSearchIndexService.h # 索引服务接口（全量构建/增量刷新/统计）
|           |   |       `-- HCIAbilityKitSearchQueryService.h # 查询模型与混合召回接口（Slice3）
|           |   `-- Private/
|           |       |-- HCIAbilityKitRuntimeModule.cpp       # Runtime 模块启动/关闭实现
|           |       |-- HCIAbilityKitAsset.cpp               # AssetImportData 初始化与资产注册标签写入
|           |       |-- Agent/
|           |       |   `-- HCIAbilityKitToolRegistry.cpp    # StageE-E1 默认 Tool 白名单与参数边界冻结实现
|           |       |-- Audit/
|           |       |   |-- HCIAbilityKitAuditRule.cpp       # StageC-C1 审计问题结构实现（Evidence 追加）
|           |       |   |-- HCIAbilityKitAuditReport.cpp     # StageC-C3 审计结果构建器（Snapshot -> Report 扁平化）
|           |       |   |-- HCIAbilityKitAuditReportJsonSerializer.cpp # StageC-C4 审计报告 JSON 序列化实现
|           |       |   |-- HCIAbilityKitAuditRuleRegistry.cpp # StageC-C1 默认规则注册（含 TriangleExpectedMismatchRule）
|           |       |   |-- HCIAbilityKitAuditScanService.cpp # StageB-B2 扫描实现（只读标签，不加载资产对象）
|           |       |   `-- HCIAbilityKitPreviewActor.cpp    # StageB-B7 预览体实现（OnConstruction/CallInEditor 刷新网格）
|           |       |-- Services/
|           |           `-- HCIAbilityKitParserService.cpp   # JSON 解析校验 + 调用 Python Hook
|           |       `-- Search/
|           |           |-- HCIAbilityKitSearchSchema.cpp    # 语义映射规则（元素/伤害档位/控制/场景/Tokens）
|           |           |-- HCIAbilityKitSearchIndexService.cpp # 资产索引构建与统计日志输出
|           |           `-- HCIAbilityKitSearchQueryService.cpp # 规则解析、候选召回与空结果建议
|           `-- HCIAbilityKitEditor/                         # 编辑器模块（导入、重导入、菜单、通知）
|               |-- HCIAbilityKitEditor.Build.cs             # Editor 依赖（UnrealEd/ToolMenus/ContentBrowser/PythonScriptPlugin）
|               |-- Public/
|               |   |-- HCIAbilityKitEditorModule.h          # Editor 模块类声明
|               |   `-- Factories/
|               |       `-- HCIAbilityKitFactory.h           # UFactory + FReimportHandler 接口声明
|               `-- Private/
|                   |-- HCIAbilityKitEditorModule.cpp        # 启动注册 Python Hook + Reimport 菜单 + Search/AuditScan/AuditExportJson/AuditScanAsync(+Stop/Retry)+ToolRegistryDump 控制台命令
|                   |-- Audit/
|                   |   |-- HCIAbilityKitAuditPerfMetrics.h # StageD-D3 性能统计辅助（吞吐率换算 + nearest-rank 分位数）
|                   |   |-- HCIAbilityKitAuditScanAsyncController.h   # StageB-B4 异步扫描状态机接口（中断/重试/失败收敛）
|                   |   `-- HCIAbilityKitAuditScanAsyncController.cpp # StageB-B4 状态机实现（batch dequeue + retry context）
|                   |-- Factories/
|                       `-- HCIAbilityKitFactory.cpp         # Import/Reimport 主流程 + 失败通知弹窗
|                   `-- Tests/
|                       |-- HCIAbilityKitAuditScanAsyncControllerTests.cpp # StageB-B4/D1/D2/D3 自动化测试（Cancel/Retry + 重试持久化 + PerfMetricsHelper）
|                       |-- HCIAbilityKitAuditRuleRegistryTests.cpp # StageC-C1/C2/C3 自动化测试（规则触发 + AuditResult 统一结构）
|                       `-- HCIAbilityKitToolRegistryTests.cpp # StageE-E1 自动化测试（白名单冻结 + args_schema 边界 + 三维业务覆盖）
|-- Source/                                                  # 项目本体源码（目前主要保留目标与文档）
|   |-- HCIEditorGen.Target.cs                               # Game Target
|   |-- HCIEditorGenEditor.Target.cs                         # Editor Target
|   `-- HCIEditorGen/
|       |-- HCIEditorGen.Build.cs                            # 本体模块构建规则
|       |-- HCIEditorGen.cpp                                 # 本体模块实现（轻量壳）
|       |-- HCIEditorGen.h                                   # 本体模块声明
|       `-- 文档/                                             # 开发/测试/进度文档目录
|           |-- 00_总进度.md                                  # 总进度主索引
|           |-- 01_技术方案_插件双模块.md                      # 架构方案文档
|           |-- 02_测试门禁与节奏.md                           # 测试节奏与门禁规则
|           |-- 03_Schema_v1与错误契约.md                      # Schema 与错误契约
|           |-- 04_代码框架总览_树状图.md                      # 当前这份结构总览文档
|           |-- 05_开发执行总方案_资产审计.md                  # 当前执行主计划（V3：资产审计优先）
|           |-- 06_合成数据生成算法说明.md                     # 10k 压测数据生成算法与参数
|           `-- 测试记录/                                      # 每个 Slice 的手测记录
`-- SourceData/                                              # 外部源数据与工具脚本（非 UE 资产目录）
    `-- AbilityKits/
        |-- HCI_Fire_01.hciabilitykit                        # 样例源文件（导入/重导入输入）
        |-- seed_mesh_manifest.json                           # Stage B0 种子网格清单（UE 长对象路径）
        |-- seed_mesh_inspection_report.json                  # 种子资产检查报告（类型分布/命名/面数）
        |-- seed_mesh_rename_report.json                      # 种子网格批量重命名执行报告
        `-- Python/
            |-- hci_abilitykit_hook.py                       # UE 内置 Python 钩子脚本（可触发受控失败）
            |-- hci_build_seed_mesh_manifest.py              # Stage B0 清单生成/校验脚本（/Game/.../Asset.Asset）
            |-- hci_generate_synthetic_assets.py             # 批量生成压测源数据（语义鸿沟+语义/性能陷阱）
            |-- hci_inspect_seed_assets.py                   # UE 内检查脚本：读取 Seed 下 StaticMesh 命名与面数
            |-- hci_rename_seed_meshes.py                    # UE 内批量重命名脚本：将非合规网格改为 SM_* 规范
            `-- tests/
                |-- test_hci_build_seed_mesh_manifest.py     # 清单脚本单测（路径格式/seed 目录扫描）
                `-- test_hci_generate_synthetic_assets.py    # 生成规则单测（比例/结构/陷阱断言）
```

```text
Import/Reimport 执行链路（当前）
.hciabilitykit -> UHCIAbilityKitFactory(Editor) -> FHCIAbilityKitParserService(Runtime)
-> hci_abilitykit_hook.py(可选) -> ApplyParsedToAsset(UHCIAbilityKitAsset)
-> AssetImportData.Update + MarkPackageDirty
```
