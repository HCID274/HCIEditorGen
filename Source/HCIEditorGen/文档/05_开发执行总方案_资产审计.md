# HCIAbilityKit 开发执行总方案（资产审计优先，半月冲刺版）

> 状态：冻结（V3）
> 更新时间：2026-02-15
> 适用范围：`HCIAbilityKit` 资产审计主链路 + AI 视觉增强（加分项）

## 1. 模块定位与边界（先定死）

- 本期主交付：`Smart Asset Auditor`（资产审计系统）。
- 本期目标：在 UE 内实现“可扩展规则审计 + 非阻塞扫描 + 可导出报告”。
- AI 视觉定位：最后阶段加分项，不影响主线交付；仅处理少量候选资产。
- 非目标（本期不做）：
  - 自动修复并回写资产；
  - 大而全流程平台化；
  - 多引擎适配与跨项目平台治理。

## 2. 半月交付目标（固定）

- `T+15` 前形成可演示闭环：
  - 10k 级资产扫描与审计可跑通；
  - 编辑器交互不中断；
  - 结果可追踪、可导出；
  - AI 视觉增强可选接入（失败可降级）。

## 3. 主线切片（唯一执行顺序）

### Stage A：文档与契约冻结（Day 1-2）

- `Slice A1`：路线重规划落文档（目标、边界、门禁）。
- `Slice A2`：审计结果契约与指标口径冻结（含 Triangle 提取来源与 RuleRegistry 约束）。
- `Slice A3`：Stage B 实战资产导入方案冻结（种子资产来源、RepresentingMesh 引用链、启动门禁）。
- 门禁：文档一致、术语一致、流程一致。

### Stage B：实战资产导入 + C++ 异步扫描主链路（Day 3-7）

- 前置门禁：仅在 `Stage A-SliceA3` 明确 `Pass` 后启动实现。
- `Slice B0`：种子资产清单接入（`/Game/.../Seed/`）与 `seed_mesh_manifest` 生成（来源允许 Quixel Bridge Nanite/AI 3D 导入高面数模型，路径固定 UE 长对象路径 `/Game/.../Asset.Asset`，禁止 OS 文件路径）。
- `Slice B1`：`UHCIAbilityKitAsset` 增加 `RepresentingMesh(TSoftObjectPtr<UStaticMesh>)` 并打通导入绑定。
- `Slice B2`：`AssetRegistry + FAssetData` 全量枚举（资产元数据 + `RepresentingMesh` 路径）。
- `Slice B3`：异步分片执行与进度汇报（UI 非阻塞）。
- `Slice B4`：任务中断/重试与失败收敛。
- `Slice B5`：采集 `triangle_count` 相关 Tags（若存在），标记 `triangle_source=tag_cached`。
- `Slice B6`：状态过滤（跳过 `Locked` 或 `Dirty 且无法安全读取` 的资产，记录跳过原因）。
- `Slice B7`：数据驱动预览体（Blueprint/C++ Actor）读取 `RepresentingMesh`，支持拖入场景可视化验证（Actor 内置 `UStaticMeshComponent`）。
- `Slice B8`：预览体自动同步：`PostEditChangeProperty` 响应资产/路径变更；Reimport 后刷新显示网格。
- 门禁：扫描过程中可持续编辑器操作，无明显冻结。

### Stage C：规则审计与报告闭环（Day 8-11）

- `Slice C1`：规则框架（`IHCIAbilityAuditRule + RuleRegistry`，含 `TriangleExpectedMismatchRule`）。
- `Slice C2`：统一审计结果结构与严重级别。
- `Slice C3`：JSON 报告导出（可追踪字段完整，含 `triangle_source`）。
- 门禁：审计异常均具备 `rule_id/reason/hint/evidence`。

### Stage D：内存与吞吐优化（Day 12-13）

- `Slice D1`：深度检查批次策略（使用 `FStreamableManager` 或等效加载机制分批同步加载 `RepresentingMesh`；提取后立即释放强引用）。
- `Slice D2`：GC 节流策略（每 N 批调用一次 `CollectGarbage`，并记录批次耗时与内存峰值）。
- `Slice D3`：峰值内存与吞吐日志监控。
- 门禁：批量审计稳定，无持续内存飙升。

### Stage E：AI 视觉增强（加分项，Day 14-15）

- `Slice E1`：疑似异常资产截图流水线（仅 `Critical` 或用户手动勾选资产，禁止全量自动截图）。
- `Slice E2`：多模态诊断输出接入审计报告。
- `Slice E3`：AI 不可用降级到纯规则结果。
- 线程边界：截图调度与渲染调用必须在主线程/Game Thread；后台线程只做队列与结果汇总。
- 门禁：AI 失败时主链路可用率 100%。

## 4. 每个切片固定执行模板（强制）

1. 先写/改文档（目标、范围、门禁）。
2. 实现并命令行编译通过。
3. 输出 UE 手测步骤与 Pass/Fail 标准（用户执行）。
4. 记录测试结果与证据。
5. 未收到 Pass，不进入下一切片。

## 5. Demo 指标（面试可讲）

- `K1` 扫描吞吐：10k 资产扫描耗时（记录 P50/P95）。
- `K2` 交互稳定：扫描期间编辑器可操作（无长时间冻结）。
- `K3` 审计可解释：异常项解释覆盖率 100%。
- `K4` 结果可追踪：关键字段完整率 100%。
- `K5` AI 降级可用：AI 不可用时主链路可用率 100%。

## 6. 风险与收束策略

- 风险：又回到“检索 demo”导致主线分散。
  - 收束：所有任务需映射“资产审计闭环”，不能映射就延期。
- 风险：1 万资产只绑定虚假字段，面数审计失真。
  - 收束：Stage B 必须先完成种子资产与 `RepresentingMesh` 引用链，未打通不得进入规则判定。
- 风险：过早 AI 化导致进度失控。
  - 收束：AI 固定后置，仅做增强，不阻塞主链路。
- 风险：扫描性能不稳。
  - 收束：先保证非阻塞，再谈复杂规则和视觉分析。
- 风险：Stage D 批量加载后内存不释放导致编辑器 OOM。
  - 收束：强制执行“批次加载 -> 提取 -> 释放 -> 节流 GC”策略，并记录峰值内存。
- 风险：Python 侧写入路径与 UE 资产路径语义不一致。
  - 收束：`seed_mesh_manifest` 固定 UE 长对象路径；路径有效性只在 Factory 导入校验，失败落 `E1006`。

## 7. 变更规则（冻结）

- 本文档为当前唯一执行主计划。
- 主线调整必须先改本文档与 `00_总进度.md`，再改代码。
- 不允许口头改路线，所有变更需文档化并标注日期。
